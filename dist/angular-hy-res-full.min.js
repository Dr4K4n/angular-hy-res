/**
 * angular-hy-res
 * @version v0.0.1 - 2014-09-13
 * @link https://github.com/petejohanson/angular-hy-res
 * @author Pete Johanson <latexer@gmail.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-hy-res",[]).factory("URITemplate",["$window",function(a){return a.URITemplate}]).provider("hrResource",function(){this.extensions=[],this.$get=["$http","$q","URITemplate","$injector",function(a,b,c,d){var e=[];angular.forEach(this.extensions,function(a){e.push(d.get(a))});var f=function(){this.$resolved=!1,this.$error=null,this.$$links={},this.$$embedded={},this.$$resolve=function(a,c){angular.extend(this,a);angular.forEach(e,function(d){d.applies(a,c)&&(angular.extend(this.$$links,d.linkParser(a,c)),angular.forEach(d.embeddedParser(a,c),function(a,d){if(angular.isArray(a)){var e=a.map(function(a){return f.embedded(a,c)});e.$promise=b.when(e),e.$resolved=!0,this.$$embedded[d]=e}else this.$$embedded[d]=f.embedded(a,c)},this))},this),this.$resolved=!0},this.$link=function(a){return this.$$links.hasOwnProperty(a)?this.$$links[a]:null},this.$embedded=function(a){return this.$$embedded.hasOwnProperty(a)?this.$$embedded[a]:null},this.$followLink=function(a,c){if(null===a)return null;if(angular.isArray(a)){var d=a.map(function(a){return f.get(a,c)});return d.$promise=b.all(d.map(function(a){return a.$promise})),d.$resolved=!1,d.$promise.then(function(){d.$resolved=!0}),d}return f.get(a,c)},this.$follow=function(a,b){var c=this.$embedded(a);return null!==c?c:this.$resolved?this.$followLink(this.$link(a),b):this.$followLink(this.$promise.then(function(b){return b.$link(a)}),b)}};f.embedded=function(a,c){var d=new f;d.$$resolve(a,c);var e=b.defer();return d.$promise=e.promise,e.resolve(d),d},f.get=function(d,e){var g=new f;return g.$promise=b.when(d).then(function(b){var d=b.href;b.templated&&(d=new c(d).expand(e.data));var f=angular.extend(e||{},{url:d});return a(f)}).then(function(a){return g.$$resolve(a.data,a.headers),g},function(){}),g};var g=function(a,b){return{get:function(){return f.get({href:a},b)}}};return g}]}),angular.module("angular-hy-res-hal",["angular-hy-res"]).service("hrHalExtension",function(){this.applies=function(a,b){return"application/hal+json"===b("Content-Type")},this.linkParser=function(a){return a._links},this.embeddedParser=function(a){return a._embedded}}).config(["hrResourceProvider",function(a){a.extensions.push("hrHalExtension")}]);