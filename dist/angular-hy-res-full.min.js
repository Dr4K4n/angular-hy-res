/**
 * angular-hy-res - Hypermedia client for AngularJS inspired by $resource
 * @version v0.0.5 - 2014-09-24
 * @link https://github.com/petejohanson/angular-hy-res
 * @author Pete Johanson <peter@peterjohanson.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
"use strict";angular.module("angular-hy-res-hal",["angular-hy-res"]).service("hrHalExtension",function(e){this.applies=function(e,n){return"application/hal+json"===n("Content-Type")},this.linkParser=function(n,r,t){if(!angular.isObject(n._links))return null;var i={};return angular.forEach(n._links,function(n,r){if(angular.isArray(n)){var o=[];angular.forEach(n,function(n){o.push(e(n,{},t))}),i[r]=o}else i[r]=e(n,{},t)}),i},this.embeddedParser=function(e){return e._embedded}}).config(["hrResourceProvider",function(e){e.extensions.push("hrHalExtension")}]);var httpLink=require("http-link");angular.module("angular-hy-res-link-header",["angular-hy-res"]).service("hrLinkHeaderExtension",function(e){this.applies=function(e,n){return null!==n("Link")},this.linkParser=function(n,r,t){for(var i=httpLink.parse(r("Link")),o={},u=0;u<i.length;u++){var s=i[u];o[s.rel]=e(s,{},t),delete s.rel}return o},this.embeddedParser=function(){return[]}}).config(["hrResourceProvider",function(e){e.extensions.push("hrLinkHeaderExtension")}]);var WebLink=function(e,n,r,t,i){angular.extend(this,e),this.$$context=n,this.$$http=r,this.$$Resource=t,this.$$URITemplate=i};WebLink.prototype.follow=function(e){var n=this.href;this.templated&&(n=new this.$$URITemplate(n).expand(e.data));var r=angular.extend(e||{},{url:n});return this.$$Resource.fromRequest(this.$$http(r))},angular.module("angular-hy-res",[]).factory("URITemplate",function(e){return e.URITemplate}).constant("hrWebLink",WebLink).factory("hrLinkCollection",function(e){function n(){var e=Object.create(Array.prototype);return e=Array.apply(e,arguments)||e,n.injectClassMethods(e),e}return n.injectClassMethods=function(e){for(var r in n.prototype)n.prototype.hasOwnProperty(r)&&(e[r]=n.prototype[r]);return e},n.fromArray=function(e){return n.apply(null,e)},n.prototype={follow:function(n){var r=this.map(function(e){return e.follow(n)});return r.$promise=e.all(r.map(function(e){return e.$promise})),r.$resolved=!1,r.$promise.then(function(){r.$resolved=!0},function(e){r.$resolved=!0,r.$error=e}),r}},n}).factory("hrWebLinkFactory",function(e,n,r){return function(t,i,o){return new e(t,i,n,o,r)}}).provider("hrResource",function(){this.extensions=[],this.$get=function(e,n,r,t){var i=[];angular.forEach(this.extensions,function(e){i.push(t.get(e))});var o=function(){this.$resolved=!1,this.$error=null,this.$$links={},this.$$embedded={},this.$link=function(e){return this.$$links.hasOwnProperty(e)?this.$$links[e]:null},this.$embedded=function(e){return this.$$embedded.hasOwnProperty(e)?this.$$embedded[e]:null},this.$followLink=function(e,r){if(null===e)return null;if(angular.isArray(e)){var t=e.map(function(e){return e.follow(r)});return t.$promise=n.all(t.map(function(e){return e.$promise})),t.$resolved=!1,t.$promise.then(function(){t.$resolved=!0}),t}if(angular.isFunction(e.follow))return e.follow(r);var i=new o;return i.$promise=n.when(e).then(function(e){return e.follow(r).$promise}).then(function(e){var n=i.$promise;return angular.copy(e,i),i.$promise=n,i}),i},this.$follow=function(e,n){var r=this.$embedded(e);return null!==r?r:this.$resolved?this.$followLink(this.$link(e),n):this.$followLink(this.$promise.then(function(n){return n.$link(e)}),n)}};return o.prototype.$$resolve=function(e,r){angular.extend(this,e);angular.forEach(i,function(t){t.applies(e,r)&&(angular.extend(this.$$links,t.linkParser(e,r,o)),angular.forEach(t.embeddedParser(e,r,o),function(e,t){if(angular.isArray(e)){var i=e.map(function(e){return o.embedded(e,r)});i.$promise=n.when(i),i.$resolved=!0,this.$$embedded[t]=i}else this.$$embedded[t]=o.embedded(e,r)},this))},this),this.$resolved=!0},o.embedded=function(e,r){var t=new o;t.$$resolve(e,r);var i=n.defer();return t.$promise=i.promise,i.resolve(t),t},o.get=function(t,i){var u=new o;return u.$promise=n.when(t).then(function(n){var t=n.href;n.templated&&(t=new r(t).expand(i.data));var o=angular.extend(i||{},{url:t});return e(o)}).then(function(e){return u.$$resolve(e.data,e.headers),u},function(){}),u},o.fromRequest=function(e){var n=new o;return n.$promise=e.then(function(e){return n.$$resolve(e.data,e.headers),n},function(){}),n},o}}).factory("hrRoot",function(e,n,r){return function(t,i){this.follow=function(){return new e({href:t},i,r,n).follow()}}});